<div class="flex bg-gray-50 rounded-2xl overflow-hidden shadow-lg border border-gray-200 h-[calc(85vh-4rem)]">

  <!-- ===================== SIDEBAR DANH SÃCH (TRÃI) ===================== -->
  <aside class="w-1/3 bg-white border-r flex flex-col h-full">
    <!-- Header -->
    <div class="p-4 border-b flex justify-between items-center bg-gray-50">
      <h2 class="text-lg font-semibold text-gray-800 flex items-center gap-2">
        ğŸ‘¥ Danh sÃ¡ch nhÃ¢n viÃªn
      </h2>
      <button
        (click)="createNewPerson()"
        class="bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 text-sm transition">
        â• ThÃªm
      </button>
    </div>

    <!-- Danh sÃ¡ch nhÃ¢n viÃªn cÃ³ scroll riÃªng -->
    <div class="flex-1 overflow-y-auto no-scrollbar fade-scroll">
      <ul class="divide-y">
        <li *ngFor="let p of persons"
            (click)="selectPerson(p)"
            [class.bg-blue-50]="selectedPerson?.person_id === p.person_id"
            class="cursor-pointer px-4 py-3 flex items-center gap-3 hover:bg-blue-100 transition border-b last:border-b-0">
          <img *ngIf="p.avatar; else defaultAvatar"
               [src]="p.avatar"
               class="w-10 h-10 rounded-full object-cover border shadow-sm">
          <ng-template #defaultAvatar>
            <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center text-gray-500">
              <i class="fas fa-user"></i>
            </div>
          </ng-template>
          <div class="flex-1 min-w-0">
            <div class="font-medium text-gray-800 truncate">{{ p.name }}</div>
            <div class="text-xs text-gray-500 truncate">{{ p.department || 'ChÆ°a cÃ³ phÃ²ng ban' }}</div>
          </div>
        </li>
      </ul>
    </div>
  </aside>

  <!-- ===================== FORM CHI TIáº¾T (PHáº¢I) ===================== -->
  <main class="flex-1 bg-gray-50 p-6 overflow-y-auto no-scrollbar h-full">
    <ng-container *ngIf="selectedPerson; else noSelection">
      <div class="bg-white rounded-2xl shadow-md p-6 space-y-6 border border-gray-100 h-full animate-fadeIn">
        <!-- Header -->
        <div class="flex items-center gap-6 border-b pb-4">
          <!-- Avatar -->
          <div class="relative group">
            <img
              [src]="previewImage || selectedPerson.avatar || 'assets/default-avatar.png'"
              class="w-28 h-28 rounded-full object-cover border shadow cursor-pointer group-hover:opacity-80 transition"
              (click)="triggerAvatarUpload()" />

            <!-- Overlay camera -->
            <div
              class="absolute inset-0 bg-black bg-opacity-40 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition cursor-pointer"
              (click)="triggerAvatarUpload()">
              <i class="fas fa-camera text-white text-xl"></i>
            </div>

            <input
              type="file"
              accept="image/*"
              #avatarInput
              class="hidden"
              (change)="onAvatarSelected($event)">
          </div>

          <div>
            <input [(ngModel)]="selectedPerson.name"
                   class="text-2xl font-semibold text-gray-800 border-none outline-none focus:ring-2 focus:ring-blue-500 rounded px-2 py-1"
                   placeholder="TÃªn nhÃ¢n viÃªn" />
            <div class="text-sm text-gray-500 mt-1">
              ID: {{ selectedPerson.person_id || 'Má»›i' }}
            </div>
          </div>
        </div>

        <!-- ThÃ´ng tin -->
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm text-gray-500 mb-1">ğŸ“ Sá»‘ Ä‘iá»‡n thoáº¡i</label>
            <input [(ngModel)]="selectedPerson.phone"
                   placeholder="Nháº­p sá»‘ Ä‘iá»‡n thoáº¡i"
                   class="w-full border rounded-lg p-2 focus:ring focus:ring-blue-200" />
          </div>
          <div>
            <label class="block text-sm text-gray-500 mb-1">ğŸ¢ PhÃ²ng ban</label>
            <input [(ngModel)]="selectedPerson.department"
                   placeholder="PhÃ²ng ban"
                   class="w-full border rounded-lg p-2 focus:ring focus:ring-blue-200" />
          </div>
          <div>
            <label class="block text-sm text-gray-500 mb-1">ğŸ’¼ Chá»©c vá»¥</label>
            <input [(ngModel)]="selectedPerson.position"
                   placeholder="Chá»©c vá»¥"
                   class="w-full border rounded-lg p-2 focus:ring focus:ring-blue-200" />
          </div>
          <!-- <div>
            <label class="block text-sm text-gray-500 mb-1">ğŸ“§ Email</label>
            <input [(ngModel)]="selectedPerson.email"
                   placeholder="Nháº­p email"
                   class="w-full border rounded-lg p-2 focus:ring focus:ring-blue-200" />
          </div> -->
        </div>

        <!-- Upload -->
        <div>
          <label class="block text-sm text-gray-500 mb-2">ğŸ–¼ áº¢nh Ä‘áº¡i diá»‡n</label>
          <input type="file" (change)="onImageSelected($event)"
                 class="w-full text-sm text-gray-700 border rounded-lg p-2 bg-gray-50 focus:ring focus:ring-blue-200">
        </div>

        <!-- Footer -->
        <div class="flex justify-between items-center border-t pt-4">
          <p class="text-sm text-gray-400">
            NgÃ y táº¡o: {{ selectedPerson.created_at | date:'short' }}
          </p>
          <div class="flex gap-3">
            <button
              (click)="updatePerson()"
              class="bg-blue-600 text-white px-5 py-2 rounded-lg hover:bg-blue-700 transition">
              ğŸ’¾ LÆ°u thay Ä‘á»•i
            </button>
            <button
              *ngIf="selectedPerson.person_id"
              (click)="deletePerson(selectedPerson.person_id)"
              class="bg-red-500 text-white px-5 py-2 rounded-lg hover:bg-red-600 transition">
              ğŸ—‘ï¸ XÃ³a
            </button>
          </div>
        </div>
      </div>
    </ng-container>

    <ng-template #noSelection>
      <div class="text-gray-500 text-center mt-40 text-lg italic">
        HÃ£y chá»n hoáº·c thÃªm má»™t nhÃ¢n viÃªn tá»« danh sÃ¡ch bÃªn trÃ¡i.
      </div>
    </ng-template>
  </main>
</div>
