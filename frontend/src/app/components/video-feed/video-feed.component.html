<div class="h-full w-full flex flex-col">
  <div class="flex items-center gap-4 bg-white p-2 border-b shadow ">
    <div class="relative">
      <button (click)="showLayoutMenu = !showLayoutMenu"
              class="px-3 py-1 border rounded text-sm bg-white shadow">
        Layout: {{ gridCols }}x{{ gridCols }}
      </button>
      <div *ngIf="showLayoutMenu"
           class="absolute mt-1 bg-white border rounded shadow z-50 w-32">
        <div *ngFor="let size of [2,4,6,8,16]"
             (click)="changeLayout(size); showLayoutMenu=false"
             class="px-3 py-1 hover:bg-gray-100 cursor-pointer">
          {{ size }}x{{ size }}
        </div>
      </div>
    </div>
    <div class="relative">
      <button (click)="showPageSizeMenu = !showPageSizeMenu"
              class="px-3 py-1 border rounded text-sm bg-white shadow">
        Hiển thị: {{ pageSize }} cams/trang
      </button>
      <div *ngIf="showPageSizeMenu"
           class="absolute mt-1 bg-white border rounded shadow z-50 w-40">
        <div *ngFor="let size of [4, 12, 16, 20, 32]"
             (click)="changePageSize(size); showPageSizeMenu=false"
             class="px-3 py-1 hover:bg-gray-100 cursor-pointer">
          {{ size }} cameras
        </div>
      </div>
    </div>

    <div class="flex items-center gap-2">
      <button (click)="prevPage()" [disabled]="currentPage === 1"
              class="px-3 py-1 border rounded text-sm bg-white shadow disabled:opacity-50">
        ◀
      </button>
      <span>Trang {{ currentPage }} / {{ totalPages }}</span>
      <button (click)="nextPage()" [disabled]="currentPage >= totalPages"
              class="px-3 py-1 border rounded text-sm bg-white shadow disabled:opacity-50">
        ▶
      </button>
    </div>
  </div>

  <div class="overflow-y-auto p-2 bg-gray-50">
    <div class="grid gap-2 w-full" [ngClass]="'grid-cols-' + gridCols">
      <div *ngFor="let cam of pagedCameras"
          (click)="openFullscreen(cam)"
          class="bg-white rounded-lg overflow-hidden shadow cursor-pointer flex flex-col">
        <h3 class="text-gray-700 bg-gray-100 px-2 py-1 text-sm truncate border-b">
          {{ cam.name }}
        </h3>

        <div class="aspect-video bg-gray-100 flex items-center justify-center">
          <ng-container *ngIf="getVideoUrl(cam.camera_id); else noSignal">
            <img [src]="getVideoUrl(cam.camera_id)"
                class="max-w-full max-h-full object-contain" />
          </ng-container>
          <ng-template #noSignal>
            <span class="text-gray-500 text-sm">Chưa có tín hiệu</span>
          </ng-template>
        </div>
      </div>

      <div *ngFor="let i of [].constructor(pageSize - pagedCameras.length)"
          class="bg-gray-50 rounded-lg border border-dashed border-gray-300 flex flex-col">
        <div class="aspect-video flex items-center justify-center text-gray-300 text-sm">
          (Trống)
        </div>
      </div>
    </div>
  </div>

</div>

<div *ngIf="fullscreenCamera"
     class="fixed inset-0 bg-black flex items-center justify-center z-50">
  <div class="relative w-full h-full">
    <button (click)="closeFullScreen()"
            class="absolute top-4 right-4 bg-red-600 text-white px-3 py-1 rounded z-50">
      Thoát
    </button>
    <ng-container *ngIf="getVideoUrl(fullscreenCamera.camera_id); else noSignalFs">
      <img [src]="getVideoUrl(fullscreenCamera.camera_id)"
           class="w-full h-full object-contain bg-black" />
    </ng-container>
    <ng-template #noSignalFs>
      <div class="w-full h-full flex items-center justify-center text-white">
        Chưa có tín hiệu
      </div>
    </ng-template>
    <div class="absolute bottom-4 left-4 text-white text-lg">
      {{ fullscreenCamera.name }}
    </div>
  </div>
</div>
